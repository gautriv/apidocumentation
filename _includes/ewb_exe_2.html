<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Styling for buttons */
        .exercise-button, .solution-button {
            background-color: #4a6ef5;
            color: #fff;
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            margin: 12px 8px;
            display: inline-block;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .exercise-button:hover, .solution-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .exercise-button {
            background-color: #4a6ef5;
        }
        
        .solution-button {
            background-color: #28a745;
        }

        /* Hidden content by default */
        .exercise-content, .solution-content {
            display: none;
            padding: 20px;
            border: 1px solid #e0e0e0;
            background-color: #f9f9f9;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .exercise-content h3, .solution-content h3 {
            color: #2c3e50;
            border-bottom: 2px solid #eaeaea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Table styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        table, th, td {
            border: 1px solid #e0e0e0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
        }

        th {
            background-color: #f0f5ff;
            font-weight: bold;
            color: #344563;
        }
        
        tr:nth-child(even) {
            background-color: #f8fafd;
        }
        
        /* Code block styling */
        pre {
            background-color: #f0f4f8;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #4a6ef5;
            font-family: monospace;
            margin: 15px 0;
        }
        
        /* List styling */
        ul, ol {
            padding-left: 25px;
        }
        
        ul li, ol li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        /* Highlight important text */
        strong {
            color: #2c3e50;
        }
        
        code {
            background-color: #f0f4f8;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }

        /* Architecture diagram styling */
        .architecture-diagram {
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
        }
        
        .note-box {
            background-color: #fff8e1;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .warning-box {
            background-color: #ffebee;
            border-left: 5px solid #f44336;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        /* Tier comparison */
        .tier-comparison {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .tier {
            flex: 1;
            min-width: 200px;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .tier h5 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 8px;
        }
    </style>
</head>
<body>
    <!-- Buttons to toggle Exercise 2 and its Solution -->
    <button class="exercise-button" onclick="toggleExercise('exercise2')">Exercise 2</button>
    <button class="solution-button" onclick="toggleSolution('solution2', 'exercise2')">Solution to Exercise 2</button>

    <!-- Exercise 2 Content (Initially Hidden) -->
    <div class="exercise-content" id="exercise2">
        <h3>Exercise 2: Documenting Multi-Tenant Webhook Architectures</h3>
        <p><strong>Scenario:</strong> You're creating documentation for a <strong>SaaS platform</strong> that provides white-labeled services to enterprise clients. Each client can have multiple sub-organizations (tenants) with unique configurations. The platform has implemented a sophisticated <strong>multi-tenant webhook architecture</strong> to serve thousands of organizations with varying needs.</p>

        <p><strong>Key Challenge:</strong> You need to document how the multi-tenant webhook system works, including tenant isolation, customization options, governance controls, and scaling considerations for enterprise customers.</p>

        <h4>Multi-Tenant Architecture Overview</h4>
        <div class="architecture-diagram">
        <pre>
                                   ┌───────────────┐
                                   │               │
                  ┌───────────────▶│  Tenant A     │───────┐
                  │                │  Webhooks     │       │
                  │                │               │       │
                  │                └───────────────┘       │
┌───────────────┐ │                                        ▼
│               │ │                                ┌───────────────┐
│  Shared       │ │                                │               │
│  Event        │ │                                │  External     │
│  Sources      │─┼───────────────┐                │  Endpoints    │
│               │ │               │                │               │
└───────────────┘ │               ▼                └───────────────┘
                  │                ┌───────────────┐       ▲
                  │                │               │       │
                  └───────────────▶│  Tenant B     │───────┘
                                   │  Webhooks     │
                                   │               │
                                   └───────────────┘</pre>
        </div>

        <h4>Key Features of the Multi-Tenant Webhook System</h4>
        <ul>
            <li><strong>Tenant Isolation:</strong> Each tenant's webhooks are processed in separate secure environments</li>
            <li><strong>Scoped Event Access:</strong> Tenants can only access events relevant to their scope</li>
            <li><strong>Tenant-Specific Configurations:</strong> Each tenant can customize their webhook delivery preferences</li>
            <li><strong>Role-Based Administration:</strong> Granular permissions for webhook management within each tenant</li>
            <li><strong>Tenant-Level Rate Limiting:</strong> Configurable rate limits for each tenant</li>
            <li><strong>Custom Security Policies:</strong> Tenant-specific security controls for webhook endpoints</li>
            <li><strong>Hierarchical Tenant Structure:</strong> Parent-child tenant relationships with inheritance options</li>
        </ul>

        <h4>Tenant Service Tiers</h4>
        <table>
            <tr>
                <th>Feature</th>
                <th>Standard Tier</th>
                <th>Enterprise Tier</th>
                <th>Global Enterprise Tier</th>
            </tr>
            <tr>
                <td>Concurrent webhook connections</td>
                <td>25 per tenant</td>
                <td>100 per tenant</td>
                <td>Unlimited</td>
            </tr>
            <tr>
                <td>Webhook delivery rate</td>
                <td>10 events/sec</td>
                <td>100 events/sec</td>
                <td>1000+ events/sec</td>
            </tr>
            <tr>
                <td>Tenant isolation level</td>
                <td>Logical isolation</td>
                <td>Resource isolation</td>
                <td>Complete physical isolation</td>
            </tr>
            <tr>
                <td>Custom retry policies</td>
                <td>No</td>
                <td>Yes</td>
                <td>Yes + SLA guarantees</td>
            </tr>
            <tr>
                <td>IP allowlisting</td>
                <td>5 IPs per tenant</td>
                <td>20 IPs per tenant</td>
                <td>Unlimited</td>
            </tr>
            <tr>
                <td>Event history retention</td>
                <td>7 days</td>
                <td>30 days</td>
                <td>1 year + custom retention</td>
            </tr>
        </table>

        <h4>Your Task</h4>
        <p>Create comprehensive documentation that:</p>
        <ol>
            <li>Explains the multi-tenant webhook architecture and how it ensures proper isolation</li>
            <li>Details configuration options at the organization, tenant, and user levels</li>
            <li>Documents governance and security controls for enterprise administrators</li>
            <li>Provides guidance on scaling webhook usage across multiple tenants</li>
            <li>Includes examples of common multi-tenant webhook patterns and anti-patterns</li>
            <li>Addresses compliance considerations for multi-tenant webhook deployments</li>
        </ol>

        <div class="warning-box">
            <p><strong>Important:</strong> Your documentation must address both technical implementation details and business governance considerations that enterprise clients need to understand.</p>
        </div>
    </div>

    <!-- Solution to Exercise 2 (Initially Hidden) -->
    <div class="solution-content" id="solution2">
        <h3>Solution to Exercise 2: Multi-Tenant Webhook Architecture Documentation</h3>

        <h4>1. Multi-Tenant Webhook Architecture</h4>
        <p>Our multi-tenant webhook architecture delivers enterprise-grade event distribution with complete tenant isolation, enabling organizations to scale their event-driven integrations across multiple business units, brands, or customer segments.</p>

        <h5>Architectural Overview</h5>
        <div class="architecture-diagram">
        <pre>
┌─────────────────────────────────┐                 ┌─────────────────────────────────┐ 
│            Platform             │                 │          Tenant Layer           │
│                                 │                 │                                 │
│  ┌─────────────┐  ┌──────────┐  │                 │  ┌─────────────┐  ┌──────────┐  │
│  │ Event       │  │ Master   │  │                 │  │ Tenant A    │  │Tenant A   │  │
│  │ Sources     │──▶ Event    │──┼─────────────────┼─▶│ Event       │──▶Webhook    │──┼───▶ Tenant A
│  │             │  │ Queue    │  │                 │  │ Queue       │  │Processor  │  │     Endpoints
│  └─────────────┘  └──────────┘  │                 │  └─────────────┘  └──────────┘  │
│                                 │                 │                                 │
│  ┌─────────────┐  ┌──────────┐  │  Event Routing  │  ┌─────────────┐  ┌──────────┐  │
│  │ Admin       │  │ Config &amp; │  │  &amp; Filtering   │  │ Tenant B    │  │Tenant B   │  │
│  │ Console     │──▶ Policy    │──┼─────────────────┼─▶│ Event       │──▶Webhook    │──┼───▶ Tenant B
│  │             │  │ Store     │  │                 │  │ Queue       │  │Processor  │  │     Endpoints
│  └─────────────┘  └──────────┘  │                 │  └─────────────┘  └──────────┘  │
│                                 │                 │                                 │
└─────────────────────────────────┘                 └─────────────────────────────────┘</pre>
        </div>

        <h5>Tenant Isolation Model</h5>
        <p>Our platform implements multiple isolation layers to ensure complete separation between tenants:</p>
        <table>
            <tr>
                <th>Isolation Layer</th>
                <th>Implementation</th>
                <th>Benefit</th>
            </tr>
            <tr>
                <td>Data Isolation</td>
                <td>Tenant-specific databases with encryption</td>
                <td>Prevents data leakage between tenants</td>
            </tr>
            <tr>
                <td>Processing Isolation</td>
                <td>Dedicated webhook processors per tenant</td>
                <td>Ensures one tenant cannot impact another's performance</td>
            </tr>
            <tr>
                <td>Network Isolation</td>
                <td>Separate outbound IP ranges for each tenant tier</td>
                <td>Enables tenant-specific IP allowlisting</td>
            </tr>
            <tr>
                <td>Credential Isolation</td>
                <td>Tenant-specific secrets and signing keys</td>
                <td>Prevents credential exposure across tenants</td>
            </tr>
            <tr>
                <td>Audit Isolation</td>
                <td>Separate audit logs per tenant</td>
                <td>Maintains clean compliance boundaries</td>
            </tr>
        </table>

        <div class="note-box">
            <p><strong>Implementation Note:</strong> For Enterprise and Global Enterprise tiers, each tenant's webhook processors run in dedicated containers or virtual machines to provide resource-level isolation.</p>
        </div>

        <h4>2. Configuration Hierarchy</h4>
        <p>Our multi-tenant webhook system uses a hierarchical configuration model that balances centralized governance with tenant-level flexibility.</p>

        <div class="tier-comparison">
            <div class="tier">
                <h5>Organization Level</h5>
                <p><strong>Configured by:</strong> Platform administrators</p>
                <ul>
                    <li>Global security policies</li>
                    <li>Organization-wide rate limits</li>
                    <li>Default retry policies</li>
                    <li>Compliance settings</li>
                    <li>IP allowlist management</li>
                    <li>Tenant provisioning</li>
                </ul>
            </div>
            
            <div class="tier">
                <h5>Tenant Level</h5>
                <p><strong>Configured by:</strong> Tenant administrators</p>
                <ul>
                    <li>Tenant-specific endpoints</li>
                    <li>Event type subscriptions</li>
                    <li>Webhook signature secrets</li>
                    <li>Delivery customization</li>
                    <li>Tenant-specific rate limits</li>
                    <li>User role assignments</li>
                </ul>
            </div>
            
            <div class="tier">
                <h5>User Level</h5>
                <p><strong>Configured by:</strong> Tenant users</p>
                <ul>
                    <li>Event filtering rules</li>
                    <li>Webhook testing</li>
                    <li>Event replay requests</li>
                    <li>Delivery monitoring</li>
                    <li>Alerting preferences</li>
                    <li>API key management</li>
                </ul>
            </div>
        </div>

        <h5>Configuration Inheritance</h5>
        <p>Child tenants inherit configuration from parent tenants with several inheritance modes:</p>
        <ul>
            <li><strong>Enforce:</strong> Child tenants must use parent settings (e.g., security policies)</li>
            <li><strong>Default:</strong> Child tenants inherit but can override parent settings</li>
            <li><strong>Independent:</strong> Child tenants configure settings independently</li>
        </ul>

        <pre>
// Example API call to configure tenant inheritance
PATCH /api/v1/organizations/{org_id}/tenants/{tenant_id}/config
{
  "webhook_settings": {
    "inheritance_mode": "default",
    "security": {
      "inheritance_mode": "enforce",
      "signature_verification": "required"
    },
    "delivery": {
      "inheritance_mode": "independent"
    }
  }
}</pre>

        <h4>3. Governance and Security Controls</h4>
        
        <h5>Role-Based Access Control</h5>
        <p>Our platform provides granular RBAC for webhook management across the organization hierarchy:</p>
        <table>
            <tr>
                <th>Role</th>
                <th>Permissions</th>
                <th>Typical Assignment</th>
            </tr>
            <tr>
                <td>Webhook Administrator</td>
                <td>Full webhook management for assigned tenants</td>
                <td>Integration team leads</td>
            </tr>
            <tr>
                <td>Webhook Creator</td>
                <td>Create and manage webhooks, cannot modify security settings</td>
                <td>Developers</td>
            </tr>
            <tr>
                <td>Webhook Monitor</td>
                <td>View webhooks and delivery status, request replays</td>
                <td>Support teams</td>
            </tr>
            <tr>
                <td>Security Auditor</td>
                <td>View webhook configurations and security settings</td>
                <td>Security teams</td>
            </tr>
        </table>

        <h5>Security Policy Enforcement</h5>
        <p>Enterprise administrators can define and enforce webhook security policies:</p>
        <pre>
// Example security policy for all tenants in an organization
POST /api/v1/organizations/{org_id}/policies/webhook-security
{
  "required_settings": {
    "signature_verification": true,
    "tls_version": "1.2+",
    "ip_restrictions": true,
    "max_retry_duration": 86400,
    "require_endpoint_validation": true
  },
  "allowed_domains": [
    "*.company.com",
    "*.approved-partner.com"
  ],
  "blocked_domains": [
    "*.public-webhook-service.com"
  ],
  "enforcement": "block_delivery"
}</pre>

        <div class="warning-box">
            <p><strong>Security Note:</strong> When a webhook delivery would violate a security policy, the request is blocked and a security alert is generated for the organization and tenant administrators.</p>
        </div>

        <h4>4. Scaling Across Tenants</h4>
        <p>Our multi-tenant webhook architecture supports horizontal scaling to accommodate growing tenant counts and increasing event volumes.</p>

        <h5>Scaling Guidelines</h5>
        <table>
            <tr>
                <th>Scaling Factor</th>
                <th>Recommendation</th>
            </tr>
            <tr>
                <td>High tenant count</td>
                <td>Use tenant pools with automatic load balancing and tenant migration capabilities</td>
            </tr>
            <tr>
                <td>High event volume per tenant</td>
                <td>Enable tenant-specific throttling and prioritization rules</td>
            </tr>
            <tr>
                <td>Spiky event patterns</td>
                <td>Implement adaptive buffer sizes and dynamic resource allocation</td>
            </tr>
            <tr>
                <td>Global distribution</td>
                <td>Configure regional webhook processors with geo-routing</td>
            </tr>
        </table>

        <h5>Load Distribution Strategies</h5>
        <p>Configure how event load is distributed across your tenant hierarchy:</p>
        <ul>
            <li><strong>Even Distribution:</strong> Events are distributed evenly across all tenants</li>
            <li><strong>Weighted Distribution:</strong> Assign processing priorities to critical tenants</li>
            <li><strong>Capacity-Based Distribution:</strong> Distribute based on tenant's allocated capacity</li>
            <li><strong>Time-Zone Optimized:</strong> Prioritize tenants during their business hours</li>
        </ul>

        <pre>
// Example tenant scaling configuration
PUT /api/v1/organizations/{org_id}/tenants/{tenant_id}/scaling
{
  "distribution_strategy": "weighted",
  "priority_weight": 3,
  "reserved_capacity": "20%",
  "burst_capacity": "50%",
  "auto_scale": true,
  "regional_distribution": {
    "us-east": "50%",
    "eu-west": "50%"
  }
}</pre>

        <h4>5. Multi-Tenant Webhook Patterns</h4>
        
        <h5>Recommended Patterns</h5>
        <div class="tier-comparison">
            <div class="tier">
                <h5>Tenant Segmentation</h5>
                <p>Create logical tenant groups with similar characteristics for optimized delivery.</p>
                <p><strong>Example:</strong> Group tenants by geography, size, or industry vertical</p>
            </div>
            
            <div class="tier">
                <h5>Hierarchical Event Filtering</h5>
                <p>Apply organization-wide filters first, then tenant-specific filters.</p>
                <p><strong>Example:</strong> Global filters for PII scrubbing, then tenant filters for relevance</p>
            </div>
            
            <div class="tier">
                <h5>Tiered Delivery SLAs</h5>
                <p>Implement different delivery guarantees based on event criticality.</p>
                <p><strong>Example:</strong> Critical events with 30-second SLA, standard events with 5-minute SLA</p>
            </div>
        </div>

        <h5>Anti-Patterns to Avoid</h5>
        <ul>
            <li><strong>Shared Webhook Endpoints:</strong> Never allow multiple tenants to send webhooks to the same endpoint without strict isolation</li>
            <li><strong>Cross-Tenant Event Access:</strong> Avoid architectures where tenants can subscribe to other tenants' events</li>
            <li><strong>Centralized Rate Limiting:</strong> Don't implement a single rate limit across all tenants, as noisy tenants can impact others</li>
            <li><strong>Inconsistent Retry Policies:</strong> Don't use different retry strategies for different tenants without clear documentation</li>
        </ul>

        <h4>6. Compliance Considerations</h4>
        <p>Multi-tenant webhook architectures require careful attention to compliance requirements, especially for regulated industries.</p>

        <h5>Compliance Features</h5>
        <table>
            <tr>
                <th>Compliance Need</th>
                <th>Platform Capability</th>
                <th>Configuration</th>
            </tr>
            <tr>
                <td>Data Residency</td>
                <td>Region-specific webhook processors</td>
                <td>Set tenant's primary processing region</td>
            </tr>
            <tr>
                <td>Data Classification</td>
                <td>Event content filtering and masking</td>
                <td>Configure PII/PCI redaction rules per tenant</td>
            </tr>
            <tr>
                <td>Audit Logging</td>
                <td>Comprehensive webhook lifecycle logging</td>
                <td>Set retention periods and export mechanisms</td>
            </tr>
            <tr>
                <td>Access Controls</td>
                <td>Fine-grained RBAC with approval workflows</td>
                <td>Define approval chains for webhook changes</td>
            </tr>
            <tr>
                <td>Encryption</td>
                <td>End-to-end payload encryption</td>
                <td>Configure tenant-specific encryption keys</td>
            </tr>
        </table>

        <h5>Compliance Documentation</h5>
        <p>The platform provides the following compliance documentation for enterprise customers:</p>
        <ul>
            <li><strong>Tenant Isolation Whitepaper:</strong> Technical details on our isolation mechanisms</li>
            <li><strong>SOC 2 Compliance Report:</strong> Third-party attestation of security controls</li>
            <li><strong>Data Processing Addendum:</strong> Legal framework for event data processing</li>
            <li><strong>Webhook Security Checklist:</strong> Step-by-step guide for secure configuration</li>
            <li><strong>Audit Log Reference:</strong> Comprehensive guide to webhook audit entries</li>
        </ul>

        <div class="note-box">
            <p><strong>Enterprise Tip:</strong> Global Enterprise customers can request custom compliance reports showing webhook delivery patterns and security configurations across their entire tenant hierarchy.</p>
        </div>

        <h4>7. Implementation Examples</h4>
        
        <h5>Example: Multi-Brand Retail Company</h5>
        <pre>
// Organization structure
Organization: RetailCorp
├── Tenant: LuxuryBrand
│   ├── Webhook: order.created → CRM system
│   └── Webhook: customer.created → Marketing platform
├── Tenant: EconomyBrand
│   ├── Webhook: order.created → Inventory system
│   └── Webhook: delivery.updated → Customer notification service
└── Tenant: OnlineBrand
    ├── Webhook: cart.abandoned → Email service
    └── Webhook: product.viewed → Analytics platform

// Security policy inheritance
LuxuryBrand: Enforces organization's security policy + additional IP restrictions
EconomyBrand: Inherits organization's security policy with default settings
OnlineBrand: Inherits organization's security policy with custom retry configuration</pre>

        <h5>Example: Financial Services Organization</h5>
        <pre>
// API call to set up tenant-specific event filtering
POST /api/v1/organizations/financial-corp/tenants/wealth-division/event-filters
{
  "global_filters": {
    "pii_fields": ["tax_id", "account_number", "date_of_birth"],
    "filter_action": "redact"
  },
  "event_specific_filters": {
    "transaction.created": {
      "amount": {
        "min_value": 10000,
        "action": "include_only"
      }
    },
    "customer.updated": {
      "updated_fields": {
        "contains": ["risk_profile", "investment_preferences"],
        "action": "include_only"
      }
    }
  }
}</pre>

        <h5>Monitoring Multi-Tenant Webhook Health</h5>
        <p>Use our centralized monitoring dashboard to track webhook performance across your tenant hierarchy:</p>
        <pre>
// API call to get cross-tenant webhook metrics
GET /api/v1/organizations/{org_id}/metrics/webhooks
{
  "time_range": "24h",
  "group_by": ["tenant", "event_type"],
  "metrics": ["delivery_success_rate", "average_latency", "error_count"]
}</pre>

        <div class="note-box">
            <p><strong>Implementation Tip:</strong> For critical enterprise integrations, set up cross-tenant alerts to notify administrators when webhook delivery success rates fall below expected thresholds across multiple tenants.</p>
        </div>
    </div>

    <script>
        function toggleExercise(exerciseId) {
            document.getElementById(exerciseId).style.display = "block";
            document.getElementById("solution2").style.display = "none";
        }

        function toggleSolution(solutionId, exerciseId) {
            document.getElementById(solutionId).style.display = "block";
            document.getElementById(exerciseId).style.display = "none";
        }
    </script>

</body>
</html> 